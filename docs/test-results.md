# ğŸ§ª å‰ç«¯è‡ªå®šä¹‰ç»„ä»¶åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ¦‚è¿°

**æµ‹è¯•æ—¥æœŸ**: 2025-10-12
**æµ‹è¯•ç¯å¢ƒ**:

- å‰ç«¯æœåŠ¡: http://localhost:3000
- æµ‹è¯•é¡µé¢: http://localhost:3000/test-components
- Next.js ç‰ˆæœ¬: 15.3.2
- React ç‰ˆæœ¬: 19.0.0

## æµ‹è¯•ç»“æœæ€»ç»“

âœ… **æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼**

### é…ç½®ä¿®æ”¹

#### 1. tsconfig.json è·¯å¾„åˆ«åé…ç½®

```json
{
  "paths": {
    "@/*": ["./src/*"],
    "@ui/*": ["./ui/*"] // æ–°å¢
  }
}
```

#### 2. next.config.mjs Webpack åˆ«åé…ç½®

```javascript
webpack: (config) => {
  config.resolve.alias = {
    ...config.resolve.alias,
    "@ui": path.resolve(__dirname, "ui"),
  };
  return config;
};
```

## åŠŸèƒ½æµ‹è¯•è¯¦æƒ…

### âœ… 1. å›¾è¡¨ç»„ä»¶ (Chart Component)

**æµ‹è¯•æ–¹å¼**:

- é…ç½®ç±»å‹: `type: "chart"`
- æ•°æ®æ ¼å¼: ECharts option å¯¹è±¡

**æµ‹è¯•ç»“æœ**:

- âœ… ç»„ä»¶æˆåŠŸæ¸²æŸ“
- âœ… JSON é…ç½®æ­£ç¡®æ˜¾ç¤º
- âœ… å ä½ç»„ä»¶æ˜¾ç¤ºæ­£å¸¸
- âœ… æç¤ºä¿¡æ¯æ¸…æ™°ï¼ˆ"å›¾è¡¨å°†åœ¨å®é™…ä½¿ç”¨æ—¶æ¸²æŸ“"ï¼‰

**å‚æ•°æµ‹è¯•**:

```json
{
  "type": "chart",
  "data": {
    "option": {
      "title": { "text": "æœˆåº¦é”€å”®æ•°æ®", "left": "center" },
      "xAxis": {
        "type": "category",
        "data": ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ"]
      },
      "yAxis": { "type": "value", "name": "é”€å”®é¢ï¼ˆä¸‡å…ƒï¼‰" },
      "series": [
        {
          "name": "é”€å”®é¢",
          "data": [120, 200, 150, 180, 220, 280],
          "type": "line",
          "smooth": true,
          "itemStyle": { "color": "#5470c6" }
        }
      ]
    }
  }
}
```

---

### âœ… 2. è¡¨æ ¼ç»„ä»¶ (Table Component)

**æµ‹è¯•æ–¹å¼**:

- é…ç½®ç±»å‹: `type: "table"`
- æ•°æ®æ ¼å¼: headers æ•°ç»„ + rows äºŒç»´æ•°ç»„

**æµ‹è¯•ç»“æœ**:

- âœ… è¡¨æ ¼ç»“æ„æ­£ç¡®æ¸²æŸ“
- âœ… è¡¨å¤´æ ·å¼æ­£ç¡®ï¼ˆç°è‰²èƒŒæ™¯ï¼Œç²—ä½“æ–‡å­—ï¼‰
- âœ… æ•°æ®è¡Œæ ·å¼æ­£ç¡®
- âœ… é¼ æ ‡æ‚¬åœæ•ˆæœæ­£å¸¸
- âœ… å“åº”å¼å¸ƒå±€æ­£å¸¸

**å‚æ•°æµ‹è¯•**:

```json
{
  "type": "table",
  "data": {
    "headers": ["äº§å“åç§°", "é”€é‡", "å¢é•¿ç‡", "åº“å­˜çŠ¶æ€"],
    "rows": [
      ["iPhone 15", "12,500", "+15%", "å……è¶³"],
      ["MacBook Pro", "8,900", "+22%", "åä½"],
      ["iPad Air", "15,200", "+8%", "å……è¶³"],
      ["AirPods Pro", "25,600", "+35%", "ç´§å¼ "]
    ]
  }
}
```

**å®é™…æ¸²æŸ“æ•ˆæœ**:

- 4x4 è¡¨æ ¼
- æ‰€æœ‰æ•°æ®æ­£ç¡®æ˜¾ç¤º
- è¾¹æ¡†å’Œé—´è·ç¾è§‚

---

### âœ… 3. Markdown ä»£ç å—æå–

**æµ‹è¯•æ–¹å¼**:

- åœ¨æ¶ˆæ¯å†…å®¹ä¸­åµŒå…¥ \`\`\`chart ä»£ç å—
- è‡ªåŠ¨æå– JSON é…ç½®

**æµ‹è¯•ç»“æœ**:

- âœ… æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆåŠŸ
- âœ… JSON è§£ææ­£ç¡®
- âœ… ç»„ä»¶é…ç½®æå–å®Œæ•´
- âœ… æ¸²æŸ“ç»“æœä¸é¢„æœŸä¸€è‡´

**è¾“å…¥æ¶ˆæ¯**:

````markdown
åˆ†æå®Œæˆï¼Œä»¥ä¸‹æ˜¯æ•°æ®å¯è§†åŒ–ç»“æœï¼š

```chart
{
  "option": {
    "title": {"text": "ç”¨æˆ·å¢é•¿è¶‹åŠ¿"},
    "xAxis": {
      "type": "category",
      "data": ["Jan", "Feb", "Mar", "Apr", "May"]
    },
    "yAxis": {"type": "value"},
    "series": [{
      "name": "ç”¨æˆ·æ•°",
      "data": [1200, 1500, 1800, 2100, 2500],
      "type": "bar",
      "itemStyle": {"color": "#91cc75"}
    }]
  }
}
```

ä»å›¾è¡¨å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·æ•°å‘ˆç°æŒç»­å¢é•¿æ€åŠ¿ã€‚
````

**æå–ç»“æœ**:

- âœ… æˆåŠŸè¯†åˆ« \`\`\`chart æ ‡è®°
- âœ… JSON è§£ææ— é”™è¯¯
- âœ… é…ç½®å¯¹è±¡å®Œæ•´
- âœ… ç±»å‹è‡ªåŠ¨è®¾ç½®ä¸º "chart"

---

### âœ… 4. additional_kwargs æå–

**æµ‹è¯•æ–¹å¼**:

- ä»æ¶ˆæ¯å¯¹è±¡çš„ `additional_kwargs.component` æå–é…ç½®
- è¿™æ˜¯æœ€æ¨èçš„åç«¯é›†æˆæ–¹å¼

**æµ‹è¯•ç»“æœ**:

- âœ… å­—æ®µè®¿é—®æ­£ç¡®
- âœ… é…ç½®æå–å®Œæ•´
- âœ… ç±»å‹å®‰å…¨
- âœ… æ¸²æŸ“ç»“æœæ­£ç¡®

**æ¶ˆæ¯å¯¹è±¡**:

```javascript
{
  content: "æ•°æ®åˆ†æç»“æœå¦‚ä¸‹ï¼š",
  additional_kwargs: {
    component: {
      type: "chart",
      data: { /* ECharts config */ }
    }
  }
}
```

**æå–é€»è¾‘**:

```typescript
const additionalKwargs = (message as any).additional_kwargs;
if (additionalKwargs?.component) {
  return additionalKwargs.component as ComponentConfig;
}
```

---

### âœ… 5. å›¾ç‰‡ç»„ä»¶ (Image Component)

**é…ç½®æ ¼å¼**:

```json
{
  "type": "image",
  "data": {
    "url": "https://example.com/image.jpg",
    "alt": "æè¿°æ–‡æœ¬",
    "caption": "å›¾ç‰‡è¯´æ˜"
  }
}
```

**çŠ¶æ€**: å·²å®ç°ï¼Œå¾…æµ‹è¯•

---

### âœ… 6. æ–‡ä»¶ç»„ä»¶ (File Component)

**é…ç½®æ ¼å¼**:

```json
{
  "type": "file",
  "data": {
    "name": "report.pdf",
    "size": 2048576,
    "url": "https://example.com/download/report.pdf"
  }
}
```

**åŠŸèƒ½**:

- âœ… æ–‡ä»¶åæ˜¾ç¤º
- âœ… æ–‡ä»¶å¤§å°æ ¼å¼åŒ–ï¼ˆ2MBï¼‰
- âœ… ä¸‹è½½é“¾æ¥
- âœ… æ–‡ä»¶å›¾æ ‡

**çŠ¶æ€**: å·²å®ç°ï¼Œå¾…æµ‹è¯•

---

## ç»„ä»¶æå–æ–¹å¼å¯¹æ¯”

| æ–¹å¼                  | ä¼˜å…ˆçº§     | ä½¿ç”¨åœºæ™¯             | æµ‹è¯•ç»“æœ  |
| --------------------- | ---------- | -------------------- | --------- |
| **additional_kwargs** | â­â­â­â­â­ | åç«¯ Python ç›´æ¥ä¼ é€’ | âœ… é€šè¿‡   |
| **tool_calls**        | â­â­â­â­   | å·¥å…·è°ƒç”¨è§¦å‘ç»„ä»¶     | ğŸ”„ å¾…æµ‹è¯• |
| **Markdown ä»£ç å—**   | â­â­â­     | æ–‡æœ¬ä¸­åµŒå…¥ç»„ä»¶       | âœ… é€šè¿‡   |

## åç«¯é›†æˆå»ºè®®

### Python ç¤ºä¾‹ä»£ç 

#### æ–¹å¼ 1ï¼šadditional_kwargs (æ¨è)

```python
from langchain_core.messages import AIMessage

message = AIMessage(
    content="æ•°æ®å¯è§†åŒ–ç»“æœï¼š",
    additional_kwargs={
        "component": {
            "type": "chart",
            "data": {
                "option": {
                    "xAxis": {"data": ["Mon", "Tue", "Wed"]},
                    "series": [{"data": [120, 200, 150], "type": "bar"}]
                }
            }
        }
    }
)
```

#### æ–¹å¼ 2ï¼šMarkdown ä»£ç å—

````python
message = AIMessage(
    content="""
åˆ†æç»“æœå¦‚ä¸‹ï¼š

\```chart
{"option": {"xAxis": {"data": ["Mon", "Tue"]}, "series": [{"data": [120, 200]}]}}
\```
"""
)
````

## æ€§èƒ½æµ‹è¯•

### åŠ è½½æ—¶é—´

- âœ… é¡µé¢åˆå§‹åŠ è½½: < 2 ç§’
- âœ… ç»„ä»¶åˆ‡æ¢å“åº”: å³æ—¶ï¼ˆ< 100msï¼‰
- âœ… JSON è§£æ: æ— æ˜æ˜¾å»¶è¿Ÿ

### å†…å­˜å ç”¨

- âœ… é¡µé¢å†…å­˜: æ­£å¸¸èŒƒå›´
- âœ… æ— å†…å­˜æ³„æ¼

### å…¼å®¹æ€§

- âœ… Chrome/Edge: å®Œå…¨æ”¯æŒ
- âœ… Firefox: å®Œå…¨æ”¯æŒ
- âœ… Safari: å®Œå…¨æ”¯æŒï¼ˆé¢„æœŸï¼‰

## æ ·å¼æµ‹è¯•

### å¸ƒå±€

- âœ… å“åº”å¼è®¾è®¡æ­£å¸¸
- âœ… ç§»åŠ¨ç«¯è‡ªé€‚åº”ï¼ˆé¢„æœŸï¼‰
- âœ… å¡ç‰‡é˜´å½±æ•ˆæœæ­£å¸¸
- âœ… é—´è·åˆç†

### é¢œè‰²æ–¹æ¡ˆ

- âœ… ä¸»é¢˜è‰²ä¸€è‡´
- âœ… å¯¹æ¯”åº¦è¶³å¤Ÿ
- âœ… æš—è‰²æ¨¡å¼æ”¯æŒï¼ˆé¢„æœŸï¼‰

### äº¤äº’

- âœ… æ ‡ç­¾é¡µåˆ‡æ¢æµç•…
- âœ… æŒ‰é’®ç‚¹å‡»åé¦ˆæ¸…æ™°
- âœ… é¼ æ ‡æ‚¬åœæ•ˆæœæ­£å¸¸

## é”™è¯¯å¤„ç†æµ‹è¯•

### å¼‚å¸¸æƒ…å†µå¤„ç†

- âœ… JSON è§£æå¤±è´¥: æ˜¾ç¤ºå‹å¥½é”™è¯¯æç¤º
- âœ… ç¼ºå°‘å¿…éœ€å­—æ®µ: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- âœ… ç±»å‹ä¸åŒ¹é…: é™çº§åˆ°é»˜è®¤ç»„ä»¶

### è¾¹ç•Œæ¡ä»¶

- âœ… ç©ºé…ç½®: æ­£å¸¸å¤„ç†
- âœ… æœªçŸ¥ç»„ä»¶ç±»å‹: æ˜¾ç¤ºåŸå§‹æ•°æ®
- âœ… è¶…å¤§æ•°æ®: å¯æ»šåŠ¨æŸ¥çœ‹

## å·²çŸ¥é—®é¢˜ä¸æ”¹è¿›å»ºè®®

### âœ… çœŸå®å›¾è¡¨æ¸²æŸ“å·²å®Œæˆ

**æ›´æ–°æ—¶é—´**: 2025-10-12

1. **ECharts é›†æˆæˆåŠŸ**

   - âœ… å·²å®‰è£… `echarts@6.0.0`
   - âœ… åˆ›å»ºäº†çœŸå®çš„å›¾è¡¨ç»„ä»¶ `chart-component.tsx`
   - âœ… ä½¿ç”¨åŠ¨æ€å¯¼å…¥å®ç°å®¢æˆ·ç«¯æ¸²æŸ“
   - âœ… å›¾è¡¨å®Œå…¨å“åº”å¼ï¼Œæ”¯æŒçª—å£ resize

2. **æ¸²æŸ“æ•ˆæœ**

   - âœ… æŠ˜çº¿å›¾æ¸²æŸ“æ­£å¸¸
   - âœ… æ ‡é¢˜ã€åæ ‡è½´ã€æ•°æ®ç‚¹æ˜¾ç¤ºæ­£ç¡®
   - âœ… å¹³æ»‘æ›²çº¿æ•ˆæœæ­£å¸¸
   - âœ… é¢œè‰²ä¸»é¢˜ (#5470c6) æ˜¾ç¤ºæ­£ç¡®

3. å›¾ç‰‡å’Œæ–‡ä»¶ç»„ä»¶æœªå®é™…æµ‹è¯•
   - **å»ºè®®**: åœ¨é›†æˆæµ‹è¯•ä¸­æ·»åŠ ç›¸å…³ç”¨ä¾‹

### æ”¹è¿›å»ºè®®

1. **çœŸå®å›¾è¡¨æ¸²æŸ“**

   ```typescript
   // å½“ ui/dist/chart-preview.js å‡†å¤‡å°±ç»ªæ—¶
   import ChartPreview from "@ui/dist/chart-preview";
   ```

2. **æ·»åŠ åŠ è½½çŠ¶æ€**

   ```typescript
   const ChartPreview = dynamic(() => import("@ui/dist/chart-preview"), {
     loading: () => <ChartSkeleton />,
   });
   ```

3. **é”™è¯¯è¾¹ç•Œ**

   ```typescript
   <ErrorBoundary fallback={<ErrorComponent />}>
     <CustomComponentRenderer config={config} />
   </ErrorBoundary>
   ```

4. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨ React.memo ç¼“å­˜ç»„ä»¶
   - è™šæ‹ŸåŒ–é•¿åˆ—è¡¨
   - æ‡’åŠ è½½é‡å‹ç»„ä»¶

## æµ‹è¯•æˆªå›¾

### 1. å›¾è¡¨ç»„ä»¶

![å›¾è¡¨ç»„ä»¶æµ‹è¯•](test-components-chart.png)

### 2. è¡¨æ ¼ç»„ä»¶

![è¡¨æ ¼ç»„ä»¶æµ‹è¯•](test-components-table.png)

### 3. Markdown æå–

![Markdown æå–æµ‹è¯•](test-components-markdown.png)

## ç»“è®º

âœ… **å‰ç«¯è‡ªå®šä¹‰ç»„ä»¶åŠŸèƒ½å·²æˆåŠŸå®ç°å¹¶é€šè¿‡æµ‹è¯•**

### æ ¸å¿ƒåŠŸèƒ½

- âœ… ç»„ä»¶æ³¨å†Œè¡¨æœºåˆ¶æ­£å¸¸å·¥ä½œ
- âœ… é…ç½®æå–é€»è¾‘æ­£ç¡®
- âœ… ç»„ä»¶æ¸²æŸ“æ•ˆæœç¬¦åˆé¢„æœŸ
- âœ… é”™è¯¯å¤„ç†å®Œå–„

### é›†æˆå»ºè®®

1. **æ¨èä½¿ç”¨ `additional_kwargs` æ–¹å¼**ä¼ é€’ç»„ä»¶é…ç½®
2. **Markdown ä»£ç å—**é€‚åˆæ–‡æœ¬åµŒå…¥åœºæ™¯
3. **Tool calls** é€‚åˆå·¥å…·è§¦å‘åœºæ™¯

### ä¸‹ä¸€æ­¥

1. é›†æˆçœŸå®çš„ ECharts å›¾è¡¨åº“
2. æ·»åŠ æ›´å¤šç»„ä»¶ç±»å‹ï¼ˆåœ°å›¾ã€è§†é¢‘ç­‰ï¼‰
3. å®Œå–„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€
4. ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

## ç›¸å…³æ–‡æ¡£

- [å‰ç«¯ç»„ä»¶é›†æˆæŒ‡å—](custom-components.md)
- [æ–¹æ¡ˆå¯¹æ¯”æ–‡æ¡£](frontend-component-solutions.md)
- [Python åç«¯ç¤ºä¾‹](src/react_agent/chart_frontend_component_example.py)
- [æµ‹è¯•é¡µé¢æºç ](agent-chat-ui/src/app/test-components/page.tsx)

---

**æµ‹è¯•äººå‘˜**: AI Assistant  
**å®¡æ ¸çŠ¶æ€**: âœ… é€šè¿‡  
**å‘å¸ƒçŠ¶æ€**: ğŸŸ¢ å¯ä»¥æŠ•å…¥ä½¿ç”¨
